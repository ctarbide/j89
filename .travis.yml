language: c
addons:
  apt_packages:
    - make
    - git
    - groff
    - ncurses-dev
    - exuberant-ctags
    - zip
  homebrew:
    packages:
      - make
      - git
      - groff
      - ncurses
      - ctags
      - zip
branches:
 - moraes
os:
 - linux
 - osx
compiler:
 - gcc
arch:
 - amd64
 - arm64
 - ppc64le
 - s390x
script:
 - |
    set -eux
    if test -x /usr/bin/getconf; then j=-j$(getconf _NPROCESSORS_ONLN); else j=; fi
    o="-O3 -Wall -pedantic"
    u=$(uname)
    case $u in
    *BSD)   e=-lutil
            t=-ltermcap
            ;;
    *)      e=
            t=-lncurses
            ;;
    esac
    make $j OPTFLAGS="$o" SYSDEFS=-D$u TERMCAPLIB=$t EXTRALIBS=$e &&
    make clean &&
    make $j OPTFLAGS="$o" SYSDEFS='-DBAREBONES -DSMALL -DJTC' TERMCAPLIB= &&
    make clean &&
    make $j OPTFLAGS="$o" SYSDEFS='-DPIPEPROCS -DPOSIX_PROCS' TERMCAPLIB=$t &&
    make clean &&
    case "$u" in
    Linux)
        make $j OPTFLAGS="$o" SYSDEFS="-DGLIBCPTY" TERMCAPLIB=$t EXTRALIBS=-lutil &&
        make clean &&
        make $j OPTFLAGS="$o" SYSDEFS="-DTERMIO -DTERMINFO -DUSE_VFORK" TERMCAPLIB=$t &&
        make clean &&
        make $j OPTFLAGS="$o" SYSDEFS="-DBSDPOSIX" TERMCAPLIB=$t &&
        make clean
        ;;
    esac &&
    make distrib jovedoss.zip
    set +eux
